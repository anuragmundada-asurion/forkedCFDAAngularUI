<section st-pipe="loadPrograms" st-table="programs">
    <div class="usa-grid-full page-heading">
        <div class="usa-width-one-half">
            <h1 style="width:99%;">Open Federal Assistance Listing</h1>
        </div>
        <div class="usa-width-one-fourth" style="margin-top:25px;">
            <a class="usa-button" ui-sref="addProgram" has-access="{{ [PERMISSIONS.CAN_CREATE_PROGRAMS] }}">Create a new listing</a>
        </div>
        <div class="usa-width-one-fourth" style="margin-top:25px;">
            <input type="search" class="bold-border" st-search placeholder="Search Listings" aria-controls="listings-table">
        </div>
    </div>
    <div class="usa-grid-full">
    <table class="listing-table cfda-table">
    <thead>
    <tr>
        <th style="width:5%"><span class="usa-sr-only">Select FAL</span></th>
        <th style="width:10%" st-sort="programNumber" st-sort-default="true" st-skip-natural="true">FAL #</th>
        <th style="width:20%" st-sort="title" st-skip-natural="true">Title</th>
        <th style="width:20%" st-sort="organizationId" st-skip-natural="true">Department/Sub-Tier Agency & Office</th>
        <th st-sort="submittedDate" st-skip-natural="true">Date Submitted</th>
        <th st-sort="publishedDate" st-skip-natural="true">Date Published</th>
        <th>Actions</th>
        <th st-sort="status" st-skip-natural="true">Status</th>
    </tr>
    </thead>
    <tbody ng-show="!isLoading">
        <tr ng-repeat="row in programs">
            <td>
                <input type="checkbox" id="program-{{$index}}">
                <label for="program-{{$index}}"></label>
            </td>
            <td>{{row.data.programNumber || '-'}}</td>
            <td>
                <div ng-show="!row.archived">
                    <div ng-show="row.status.code === 'published'">
                        <a ui-sref="reviewProgram({ id: row.id })">{{row.data.title}}</a>
                    </div>
                    <div ng-show="row.status.code === 'draft' || row.status.code === 'rejected'">
                        <a ng-show="authorize([PERMISSIONS.CAN_EDIT_DRAFT_PROGRAMS])" ui-sref="editProgram({ id: row.id, section: 'review' })">{{row.data.title}}</a>
                        <a ng-show="!authorize([PERMISSIONS.CAN_EDIT_DRAFT_PROGRAMS])" ui-sref="reviewProgram({ id: row.id })">{{row.data.title}}</a>
                    </div>
                    <div ng-show="row.status.code === 'revised'">
                        <a ui-sref="reviewProgram({ id: row.id })">{{row.data.title}}</a>
                    </div>
                    <div ng-show="row.status.code === 'pending'">
                        <a ng-show="authorize([PERMISSIONS.CAN_EDIT_PENDING_PROGRAMS])" ui-sref="editProgram({ id: row.id, section: 'review' })">{{row.data.title}}</a>
                        <a ng-show="!authorize([PERMISSIONS.CAN_EDIT_PENDING_PROGRAMS])" ui-sref="reviewProgram({ id: row.id })">{{row.data.title}}</a>
                    </div>
                </div>
                <div ng-show="row.archived">
                    <a ui-sref="reviewProgram({ id: row.id })">{{row.data.title}}</a>
                </div>
            </td>
            <td>
                <federal-hierarchy-label organization-id="{{row.data.organizationId}}"></federal-hierarchy-label>
            </td>
            <td>{{row.submittedDate | date:'medium' }}</td>
            <td>{{row.publishedDate | date:'medium' }}</td>
            <td class="action-row">
                <button has-access="{{ [PERMISSIONS.CAN_EDIT_DRAFT_PROGRAMS] }}" ng-show="(row.status.code === 'draft' || row.status.code === 'rejected') && !row.archived" type="button" title="Edit FAL" ng-click="editProgram({ id: row.id, section: 'review' })"><span class="fa fa-pencil"></span></button>
                <button has-access="{{ [PERMISSIONS.CAN_EDIT_PENDING_PROGRAMS] }}" ng-show="row.status.code === 'pending' && !row.archived" type="button" title="Edit FAL" ng-click="editProgram({ id: row.id, section: 'review' })"><span class="fa fa-pencil"></span></button>

                <button has-access="{{ [PERMISSIONS.CAN_DELETE_DRAFT_PROGRAMS] }}" ng-show="(row.status.code === 'draft' || row.status.code === 'rejected') && !row.archived" type="button" title="Delete FAL" ng-click="deleteProgram(row)"><span class="fa fa-trash-o"></span></button>

                <button has-access="{{ [PERMISSIONS.CAN_REQUEST_ARCHIVE] }}" type="button" ng-show="row.status.code === 'published' && !row.archived" title="Request Archive" ng-click="showProgramRequestModal(row, 'program_request', 'archive_request')"><span class="fa fa-folder"></span></button>
                <button has-access="{{ [PERMISSIONS.CAN_REQUEST_UNARCHIVE] }}" type="button" ng-show="row.status.code === 'published' && row.archived" title="Request Unarchive" ng-click="showProgramRequestModal(row, 'program_request', 'unarchive_request')"><span class="fa fa-folder-open"></span></button>
                <button has-access="{{ [PERMISSIONS.CAN_REQUEST_TITLE_CHANGE] }}" type="button" ng-show="row.status.code === 'published' && !row.archived" title="Request Title Change" ng-click="showProgramRequestModal(row, 'program_request', 'title_request')"><span class="fa fa-i-cursor"></span></button>
            </td>
            <td>{{row.archived ? 'Archived' : row.status.value}}</td>
        </tr>
        <tr ng-show="!programs || programs.length == 0">
            <td colspan="8" class="text-center">No Results Found</td>
        </tr>
    </tbody>
    <tbody ng-show="isLoading">
    <tr>
        <td colspan="8" class="text-center">Loading ...</td>
    </tr>
    </tbody>
</table>
    </div>
    <div class="pagination-panel">
        <div class="pagination-controls usa-grid-full">
            <div class="pagination-item-count-control">
                <span>Showing </span>
                <label class="usa-sr-only" for="items-by-page">Number of items to view per page</label>
                <select id="items-by-page" class="usa-form-medium bold-border" ng-model="itemsByPage" ng-options="pageNum for pageNum in itemsByPageNumbers">
                </select>
                <span> Per Page</span>
            </div>
            <div st-pagination="" st-items-by-page="itemsByPage" st-displayed-pages="10" st-template="programs/programs-list-pagination.tpl.html"></div>
        </div>
    </div>
</section>
